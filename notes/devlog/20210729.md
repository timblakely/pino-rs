## SysTick

Need a blocking wait for the ADC calibrations from [yesterday](./20210728.md). Will try to use SysTick instead of sacrificing a timer.

- I don't want to pay for the overhead of an interrupt every tick and want to see if we can get microsecond resolution
  - Got the peripheral up and running, but seems mis-calibrated; 5e6 micros lasted less than a second...?
  - Oh, turns out I was calculating it assuming the timer was counting micros, not clock cycles
- There's a bit of subtlety to blocking for microseconds
  - SysTick is 24 bit, which means the maximum number of ticks before we hit the wrap bit is 2^24
  - If we want to sleep for something like 1s, we need to account for multiple loops
- And it works!

## Back to the ADC
- Okay, getting somewhere. Looks like I can get it into calibration mode but... it gets stuck there
  - Usually when this happens it's because there's some clock domain that's not turned on or messed up
  - Datasheet suggests max ADC freq is 60MHz for single adc, or 52 for all ADCs in single-ended mode:
    ![](images/2021-07-29-21-17-06.png)
  - 170Mhz / 4 gives about 42.5MHz, which should be fine for my purposes
  - Aha, yup! Now that `ADC345_COMMON[CCR]` has the right clocks, calibration finishes.
- Beginning startup
  - Kinda odd that you have to write 1 to `ADRDY` to clear it, but whatever :zany_face:
  -
