## More ADC work

So after sleeping on it I'm pretty sure it has to do with the input impedance and ADC capacitance. We're just not letting the input cap charge up fast enough to sample at 2.5 cycles. Ramping up to ~47.5 seemed to make it go away. The VBus shouldn't change all _that_ much, so I suspect that it should be okay keeping it at 47.5 ADC samples.

- Settling on 47.5 ADC samples. Seems consistent enough
- Bingo! Got continuous conversion mode up and running
  - Looks pretty linear:

    ![](images/2021-07-30-13-25-02.png)
  - Seems like it's roughly 76.345 bits/V
  - Offset of 11 though, wonder if that affects much?
  - 3.3v/Vref rail is spot on though
- Okay, digging into this the old-fashioned way: breakin' out the multimeter
  - At 24.01V on the bus, I'm reading 1.432V at the sampling pin. Calibrated ADC reads 0x733 (1843)
  - That gives us `1843/4096 * Vref = 0.450 * 3.3 = 1.485`, off by 0.053. Odd.
  - Oh, wait. Without the ADC on it's at a rock solid 1.5V. I'll bet there's Vdroop due to the sampling cap!
    - Ayup; bingo: RMS voltage due to the initial droop due to charging the sampling cap is probably the cause of the mismatch:

      ![](images/2021-07-30-14-44-10.png)
  - What to do about it though... can't slow down the ADC sampling since one of the phase current senses is on ADC, which is tied to the slave clock that drives ADC[345]
    - TODO(blakely): Potentially add a V1.1 add a cap to the ADC sampling line
    - From AN2834:

      ![](images/2021-07-30-14-50-25.png)
      - Note the issue about cycling, which may stress the cap
  - Okay, well, it's about as good as it's going to get; jacked up the sampling time to 640.5 samples. Doesn't need to be all that real-time; lithium batteries are pretty good about handing current spikes without sag
